<div class="w-full h-full p-6 rounded-xl text-white bg-[#1f1f1f]">
  <h2 class="text-[22px] font-bold mb-6">{{ isEditMode ? 'Editar Cita' : 'Nueva Cita' }}</h2>

  <form [formGroup]="appointmentForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-4">

    <div>
      <label class="block text-sm font-medium mb-1">Título de la cita</label>
      <input type="text" formControlName="title"
             class="w-full px-4 py-2 rounded-lg bg-[#2b2b2b] text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-400"
             placeholder="Ej: Consulta de seguimiento">
    </div>

    <div>
      <p class="text-sm font-semibold mb-2">Fecha y hora de inicio</p>
      <div class="flex flex-col md:flex-row gap-4">
        <mat-form-field appearance="fill" class="flex-1 bg-[#2b2b2b] rounded-lg">
          <mat-label>Fecha inicio</mat-label>
          <input matInput [matDatepicker]="startPicker" formControlName="startDate">
          <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="fill" class="flex-1 bg-[#2b2b2b] rounded-lg">
          <mat-label>Hora inicio</mat-label>
          <mat-select formControlName="startTime">
            <mat-option *ngFor="let time of timeOptions" [value]="time">{{ time }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <div>
      <p class="text-sm font-semibold mb-2">Fecha y hora de fin</p>
      <div class="flex flex-col md:flex-row gap-4">
        <mat-form-field appearance="fill" class="flex-1 bg-[#2b2b2b] rounded-lg">
          <mat-label>Fecha fin</mat-label>
          <input matInput [matDatepicker]="endPicker" formControlName="endDate">
          <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="fill" class="flex-1 bg-[#2b2b2b] rounded-lg">
          <mat-label>Hora fin</mat-label>
          <mat-select formControlName="endTime">
            <mat-option *ngFor="let time of timeOptions" [value]="time">{{ time }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <mat-form-field appearance="fill" class="w-full bg-[#2b2b2b] rounded-lg">
      <mat-label>Paciente</mat-label>
      <mat-select formControlName="patientId">
        <mat-option *ngFor="let patient of patients" [value]="patient.id">
          {{ patient.name }} {{ patient.lastname }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full bg-[#2b2b2b] rounded-lg">
      <mat-label>Médico</mat-label>
      <mat-select formControlName="doctorId">
        <mat-option *ngFor="let doctor of doctors" [value]="doctor.id">
          {{ doctor.name }} {{ doctor.lastname }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <div>
      <label class="block text-sm font-medium mb-1">Descripción</label>
      <textarea formControlName="description" rows="3"
                class="w-full px-4 py-2 rounded-lg bg-[#2b2b2b] text-white placeholder-gray-400 focus:outline-none"
                placeholder="Detalles adicionales de la cita"></textarea>
    </div>

    <mat-form-field appearance="fill" class="w-full bg-[#2b2b2b] rounded-lg">
      <mat-label>Invitados (opcional)</mat-label>
      <mat-select formControlName="guestIds" multiple>
        <mat-option *ngFor="let user of allUsers" [value]="user.id">
          {{ user.name }} {{ user.lastname }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <div class="flex justify-end gap-3 pt-4">
      <button type="button"
              class="h-10 px-5 rounded-full bg-[#393028] text-white font-bold text-sm"
              (click)="dialogRef.close()">Cancelar</button>

      <button type="submit"
              class="h-10 px-5 rounded-full bg-[#f2730c] text-white font-bold text-sm flex items-center gap-2"
              [disabled]="isLoading">
        <span *ngIf="!isLoading">{{ isEditMode ? 'Actualizar' : 'Crear' }}</span>
        <mat-spinner *ngIf="isLoading" diameter="20" strokeWidth="2"></mat-spinner>
      </button>

      <button *ngIf="isEditMode" type="button"
              class="h-10 px-5 rounded-full bg-red-600 text-white font-bold text-sm"
              (click)="onDelete()" [disabled]="isLoading">
        Eliminar
      </button>
    </div>
  </form>
</div>
